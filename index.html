<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë‹ˆì¼€ ì˜¤ë²„ë¡œë“œ ì¢…ê²°ê¸‰ ì „ëµ ë¶„ì„ê¸°</title>
    <style>
        :root { --nike-gold: #ffeb3b; --nike-blue: #00e5ff; --bg: #121212; --card: #1e1e1e; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg); color: #e0e0e0; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background-color: var(--card); padding: 25px; border-radius: 15px; max-width: 700px; width: 100%; border: 1px solid #333; }
        .highlight { color: var(--nike-gold); font-weight: bold; }
        .strategy-box { background: #252525; padding: 15px; border-radius: 10px; border-left: 4px solid var(--nike-blue); margin-top: 20px; font-size: 0.9rem; line-height: 1.6; }
        .stat-badge { background: #444; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì˜¤ë²„ë¡œë“œ 3ì˜µì…˜ & ê³ ì  ì ê¸ˆ ì‹œë®¬ë ˆì´í„°</h1>
        
        <div style="margin: 20px 0;">
            ë³´ìœ  ëª¨ë“ˆ: <input type="number" id="moduleInput" value="500" style="width: 80px; background: #333; color: white; border: 1px solid #555;">
        </div>

        <div id="targetContainer">
            <div class="target-row">
                <select id="opt1"></select> <input type="number" id="val1" placeholder="ëª©í‘œ í•©ê³„%">
            </div>
            <div class="target-row">
                <select id="opt2"></select> <input type="number" id="val2" placeholder="ëª©í‘œ í•©ê³„%">
            </div>
            <div class="target-row">
                <select id="opt3"></select> <input type="number" id="val3" placeholder="ëª©í‘œ í•©ê³„%">
            </div>
        </div>

        <button onclick="runUltimateSim()" style="width: 100%; padding: 15px; background: var(--nike-gold); border: none; font-weight: bold; cursor: pointer; border-radius: 8px; margin-top: 15px;">ì¢…ê²° ê²½ë¡œ ë¶„ì„ ì‹œì‘</button>
        <div id="result">ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>

<script>
// ë°ì´í„° êµ¬ì¡° ë° í™•ë¥  ì„¸íŒ… (ì´ì „ê³¼ ë™ì¼)
const optionData = [
    { name: "ì„ íƒ ì•ˆ í•¨", weight: 0, levels: Array(15).fill(0) },
    { name: "ìš°ì›”ì½”ë“œ", weight: 10, levels: [9.54, 10.94, 12.34, 13.75, 15.15, 16.55, 17.95, 19.35, 20.75, 22.15, 23.56, 24.96, 26.36, 27.76, 29.16] },
    { name: "ê³µê²©ë ¥", weight: 10, levels: [4.77, 5.47, 6.18, 6.88, 7.59, 8.29, 9.00, 9.70, 10.40, 11.11, 11.81, 12.52, 13.22, 13.93, 14.63] },
    { name: "ìµœëŒ€ì¥íƒ„", weight: 12, levels: [27.84, 31.95, 36.06, 40.17, 44.28, 48.39, 52.50, 56.60, 60.71, 64.82, 68.93, 73.04, 77.15, 81.26, 85.37] }
];
const slotProbs = [1.0, 0.5, 0.3];
const stepProbs = [12,12,12,12,12,7,7,7,7,7,1,1,1,1,1];

function getLevelWithRank(idx) {
    let r = Math.random() * 100, cum = 0;
    for (let i=0; i<15; i++) { 
        cum += stepProbs[i]; 
        if (r <= cum) return { val: optionData[idx].levels[i], rank: i + 1 }; 
    }
    return { val: optionData[idx].levels[14], rank: 15 };
}

function runUltimateSim() {
    const totalM = parseInt(document.getElementById('moduleInput').value);
    const targets = [
        { id: parseInt(document.getElementById('opt1').value), val: parseFloat(document.getElementById('val1').value) },
        { id: parseInt(document.getElementById('opt2').value), val: parseFloat(document.getElementById('val2').value) },
        { id: parseInt(document.getElementById('opt3').value), val: parseFloat(document.getElementById('val3').value) }
    ].filter(t => t.id > 0);

    let success = 0;
    for (let i = 0; i < 1500; i++) {
        let gear = [[0,0,0], [0,0,0], [0,0,0], [0,0,0]];
        let gearStats = [[{},{},{}], [{},{},{}], [{},{},{}], [{},{},{}]];
        let m = totalM;

        // ì´ˆê¸° ì˜¤ë²„ë¡œë“œ ìƒëµ(ë£¨í”„ ë‚´ í¬í•¨)
        while(m > 0) {
            let sums = {};
            targets.forEach(t => {
                let s = 0;
                for(let g=0; g<4; g++) {
                    for(let sl=0; sl<3; sl++) if(gear[g][sl] === t.id) s += gearStats[g][sl].val;
                }
                sums[t.id] = s;
            });
            if(targets.every(t => sums[t.id] >= t.val)) { success++; break; }

            // ë¶€ìœ„ ì„ íƒ ë° ì „ëµ
            let g = Math.floor(Math.random() * 4);
            let ownedInGear = [];
            for(let sl=0; sl<3; sl++) if(targets.some(t => t.id === gear[g][sl])) ownedInGear.push(sl);

            // [ìƒí™©ë³„ ì ê¸ˆ íŒë‹¨]
            if(ownedInGear.length === targets.length) {
                // ìˆ˜ì¹˜ ë³€ê²½ ëª¨ë“œ
                let highRankSlots = ownedInGear.filter(sl => gearStats[g][sl].rank >= 11);
                if(highRankSlots.length > 0 && m >= (highRankSlots.length + 1)) {
                    // ê³ ì  ì˜µì…˜ ì ê¸ˆ ìˆ˜ì¹˜ ë³€ê²½ (ë¹„ìš© 2~3)
                    m -= (highRankSlots.length + 1);
                    ownedInGear.forEach(sl => {
                        if(!highRankSlots.includes(sl)) {
                            let res = getLevelWithRank(gear[g][sl]);
                            if(res.val > gearStats[g][sl].val) gearStats[g][sl] = res;
                        }
                    });
                } else {
                    // ì¼ë°˜ ìˆ˜ì¹˜ ë³€ê²½ (ë¹„ìš© 1)
                    m -= 1;
                    ownedInGear.forEach(sl => {
                        let res = getLevelWithRank(gear[g][sl]);
                        if(res.val > gearStats[g][sl].val) gearStats[g][sl] = res;
                    });
                }
            } else {
                // íš¨ê³¼ ë³€ê²½ ëª¨ë“œ (ì ê¸ˆ í¬í•¨)
                let cost = ownedInGear.length + 1;
                if(m < cost) break;
                m -= cost;
                for(let sl=0; sl<3; sl++) {
                    if(!ownedInGear.includes(sl)) {
                        if(Math.random() <= slotProbs[sl]) {
                            let rid = targets[Math.floor(Math.random()*targets.length)].id;
                            gear[g][sl] = rid; gearStats[g][sl] = getLevelWithRank(rid);
                        } else { gear[g][sl] = 0; gearStats[g][sl] = {val:0, rank:0}; }
                    }
                }
            }
        }
    }

    document.getElementById('result').innerHTML = `ì„±ê³µ í™•ë¥ : <span class="highlight">${(success/1500*100).toFixed(1)}%</span>
    <div class="strategy-box">
        <b>ğŸ’ ì¢…ê²° ì˜µì‘ ê°€ì´ë“œ (3ì˜µì…˜ & ê³ ì  ê´€ë¦¬):</b><br>
        â€¢ <b>3ì˜µì…˜ í™•ë³´:</b> 2ê°œì˜ ìœ íš¨ ì˜µì…˜ì´ ë–´ë‹¤ë©´ ë¬´ì¡°ê±´ ì ê·¸ê³  3ë²ˆì§¸ë¥¼ ë…¸ë¦¬ì„¸ìš”. ìŠ¬ë¡¯ë‹¹ í™•ë¥  ë•Œë¬¸ì— ìŒ©ìœ¼ë¡œ 3ê°œë¥¼ ë„ìš°ëŠ” ê±´ ê±°ì˜ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
        â€¢ <b>ìˆ˜ì¹˜ ì ê¸ˆ ì „ëµ:</b> íŠ¹ì • ì˜µì…˜ì´ <span class="stat-badge">11ë‹¨ ì´ìƒ</span>ì´ë¼ë©´ ì ê·¸ê³  ìˆ˜ì¹˜ ë³€ê²½ì„ í•˜ëŠ” ê²ƒì´ ìˆ˜ì¹˜ ì´í•©ì„ ì˜¬ë¦¬ëŠ” ë° íš¨ìœ¨ì ì…ë‹ˆë‹¤.<br>
        â€¢ <b>ìŠ¬ë¡¯ ìš°ì„ ìˆœìœ„:</b> 3ë²ˆ ìŠ¬ë¡¯(30%)ì— ìœ íš¨ ì˜µì…˜ì´ ëœ¨ëŠ” ê²ƒì´ 'ê¸°ì 'ì´ë¯€ë¡œ, 3ë²ˆì— ëª©í‘œ ì˜µì…˜ì´ ëœ¨ë©´ ìˆ˜ì¹˜ê°€ ë‚®ì•„ë„ ì¼ë‹¨ ê³ ì •í•˜ëŠ” ê²ƒì´ ì •ë‹µì…ë‹ˆë‹¤.
    </div>`;
}
// ì´ˆê¸°í™” ìƒëµ
</script>
</body>
</html>
